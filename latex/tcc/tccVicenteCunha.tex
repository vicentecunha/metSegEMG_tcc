\input{preamble.tex}

\titulo{Métodos de Segmentação Automática de Sinais de Eletromiografia de Superfície para Classificação de Movimentos Utilizando Redes Neurais Artificiais}
\autor
{
	UNIVERSIDADE FEDERAL DO RIO GRANDE DO SUL\\
	ESCOLA DE ENGENHARIA\\
	DEPARTAMENTO DE ENGENHARIA ELÉTRICA\\
	\vspace*{4\baselineskip} 
	VICENTE COSTAMILAN DA CUNHA
}
\local{Porto Alegre}
\data{2015}
\orientador{Prof. Dr. Eng. Alexandre Balbinot}
\coorientador{}
\instituicao{}
\tipotrabalho{Monografia (graduação)}
% O preambulo deve conter o tipo do trabalho, o objetivo, 
% o nome da instituição e a área de concentração 
\preambulo{Projeto de Diplomação apresentado ao Departamento de Engenharia Elétrica da Escola de Engenharia da Universidade Federal do Rio Grande do Sul, como requisito parcial para Graduação em Engenharia Elétrica}

% --- 

% ---
% compila o indice
% ---
\makeindex
% ---

\begin{document}
\selectlanguage{brazil}
\frenchspacing 
\imprimircapa
\imprimirfolhaderosto*

%=========================================================================
% FOLHA DE APROVAÇÃO
%=========================================================================

\begin{folhadeaprovacao}

  \begin{center}
    {\ABNTEXchapterfont\large\imprimirautor}

    \vspace*{\fill}\vspace*{\fill}
    \begin{center}
      \ABNTEXchapterfont\bfseries\Large\imprimirtitulo
    \end{center}
    \vspace*{\fill}
    
    \hspace{.45\textwidth}
    \begin{minipage}{.5\textwidth}
        \imprimirpreambulo
    \end{minipage}%
    \vspace*{\fill}
   \end{center}
        
   Trabalho aprovado. \imprimirlocal, 03 de dezembro de 2015:

   \assinatura{\textbf{\imprimirorientador} \\ Orientador} 
   \assinatura{\textbf{Prof. Dr. Eng. Altamiro Susin} \\ Convidado}
   \assinatura{\textbf{M.ª Eng. Gabriela Favieiro} \\ Convidada}
   \assinatura{\textbf{Eng. Vinicius Cene} \\ Suplente}
   %\assinatura{\textbf{Professor} \\ Convidado 4}
      
%   \begin{center}
%    \vspace*{0.5cm}
%    {\large\imprimirlocal}
%    \par
%    {\large\imprimirdata}
%    \vspace*{1cm}
%  \end{center}
  
\end{folhadeaprovacao}

%=========================================================================
% DEDICATÓRIA
%=========================================================================

\begin{dedicatoria}
   \vspace*{\fill}
   \centering
   \noindent
   \textit{ A Gilberto, mi padre, torre de razón y de firme fe; \\ e a todos aqueles que tomarem interesse neste estudo.} \vspace*{\fill}
\end{dedicatoria}

%=========================================================================
% AGRADECIMENTOS
%=========================================================================

\begin{agradecimentos}
	Aos demais colaboradores e pesquisadores do laboratório de Instrumentação Eletro-Eletrônica, em especial Vinicius Cene e Fernanda Trevisol, que desenvolveram a coleta da base de dados utilizada e prestaram auxílio de forma geral.
\end{agradecimentos}

%=========================================================================
% EPÍGRAFE
%=========================================================================

\begin{epigrafe}
    \vspace*{\fill}
	\begin{flushright}
		\textit{Take nothing on its looks;\\ take everything on evidence.\\ There's no better rule.}\\ \vspace{\onelineskip}
		Charles Dickens, Great Expectations
	\end{flushright}
\end{epigrafe}

%=========================================================================
% RESUMOS
%=========================================================================

% resumo em português
\setlength{\absparsep}{18pt} % ajusta o espaçamento dos parágrafos do resumo
\begin{resumo}

	A segmentação de sinais de eletromiografia (EMG) é parte essencial da etapa de preprocessamento em aplicações de reconhecimento de movimentos e controle de próteses. Métodos de segmentação automática possibilitam a individualização de trechos de interesse do sinal correspondentes a esforços musculares e o descarte de trechos de sinal com baixa atividade muscular, por exemplo. Neste estudo, quatro métodos para segmentação automática de sinais de EMG de superfície, adaptados de outros trabalhos na área, foram propostos e implementados em MATLAB R2015a. Os métodos foram aplicados nos sinais da base de dados do projeto NinaPro e nos sinais da base de dados adquiridos pelo Laboratório de Instrumentação Eletro-Eletrônica da UFRGS. Redes neurais artificais (RNAs)foram utilizadas para classificar os sinais segmentados com os quatro métodos entre 17 movimentos de mão e punho. \textcolor{red}{TODO: RESULTADOS}.

	\vspace{\onelineskip}
	\textbf{Palavras-chave}: Eletromiografia de Superfície. Segmentação de Sinais. Redes Neurais Artificiais.
\end{resumo}

% resumo em inglês
\begin{resumo}[Abstract]
 \begin{otherlanguage*}{english}
	\textcolor{red}{TODO: TRADUZIR RESUMO}.
	
   \vspace{\onelineskip}
   \noindent 
   \textbf{Keywords}: Surface Eletromiography. Signal Segmentation. Artificial Neural Networks.
 \end{otherlanguage*}
\end{resumo}

%=========================================================================
% SUMÁRIOS
%=========================================================================

% inserir lista de ilustrações
\pdfbookmark[0]{\listfigurename}{lof}
\listoffigures*
\cleardoublepage

% inserir lista de tabelas
\pdfbookmark[0]{\listtablename}{lot}
\listoftables*
\cleardoublepage

% inserir lista de abreviaturas e siglas
\begin{siglas}
	\item[BEP]		\emph{Beginning Extraction Point}
	\item[DAQ]		\emph{Data Acquisition}
	\item[DBSCAN]	\emph{Density-Based Spatial Clustering of Applications with Noise}
	\item[EEP]		\emph{Ending Extraction Point}
  	\item[EMG]		Eletromiografia
	\item[EMGs]		Eletromiografia de Superfície
	\item[IEE]		Laboratório de Instrumentação Eletro-Eletrônica
	\item[MU]		\emph{Motor Unit}
  	\item[MUAP]		\emph{Motor Unit Action Potencial}
	\item[MUAPT]	\emph{Motor Unit Action Potencial Trains}
	\item[MTD\#]	\emph{Método Número \#}
	\item[NI]		\emph{National Instruments}
	\item[NinaPro]	\emph{Non-Invasive Adaptive Prosthetics project}
	\item[RNA]		Rede Neural Artificial
\end{siglas}

% inserir o sumario
\pdfbookmark[0]{\contentsname}{toc}
\tableofcontents*
\cleardoublepage

\textual
%=========================================================================
% INTRODUÇÃO
	\chapter{Introdução}
%=========================================================================
Sinais de EMG apresentaram crescentes aplicações no controle de próteses mioelétricas. \cite{Hargrove2013} mostraram o controle de uma prótese de perna de um amputado acima do joelho direito, enquanto \cite{Jun-UkChu2007} apresentaram bons resultados de reconhecimento de padrões de EMG para desenvolvimento de uma prótese multifuncional de mão. Em área paralela ao controle de próteses, \cite{Pattichis1995} realizam diagnósticos clínicos de desordens neuromusculares com sinais de EMG e redes neurais artificiais.

As principais estratégias para caracterização de sinais de EMG e potenciais de ação das unidades motoras baseiam-se no uso de um método classificador. Métodos de classificação utilizados incluem - entre inúmeros outros - Redes Neurais Artificiais \cite{Hudgins1993}, classificador Bayesiano \cite{Englehart2003}, lógica \emph{Fuzzy} \cite{Chan2000} e \emph{Neuro-Fuzzy} \cite{Favieiro2011}. Tais sistemas de classificação necessitam, como parte do preprocessamento, segmentar os sinais de EMG adquiridos, para então realizar extração de características dos segmentos como amplitude, número de cruzamentos por zero, coeficientes de autoregressão, transformadas de Fourier e, mais recentemente, transformadas Wavelet \cite{Jun-UkChu2007}.

Neste trabalho, é proposto e implementado em MATLAB quatro diferentes métodos de segmentação automática para sinais de EMG de superfície (EMGs). Os primeiros dois métodos (que serão identificados neste estudo pelas abreviações MTD1 e MTD2) tratam da detecção de picos do sinal utilizando \emph{thresholding} e produzem segmentos de comprimento constante centrados nestes picos. O terceiro (MTD3) e quarto (MTD4) métodos utilizam uma janela deslizante para identificação de pontos iniciais e finais dos segmentos, produzindo segmentos de comprimento variável.

O primeiro método (MTD1) é baseado no método de segmentação utilizado em \cite{Chauvet2001}. Trata-se de método iterativo, identificando os picos do sinal a partir de \emph{threshold} de amplitude, segmentando o sinal em janelas de comprimento constante centradas nos picos. O valor de \emph{threshold} para a primeira iteração corresponde ao máximo absoluto do sinal. A cada nova iteração em que não se atinge uma razão mínima arbitrada entre número de segmentos e comprimento de sinal, o novo \emph{threshold} é calculado como fração do \emph{threshold} da iteração anterior.

O segundo método (MTD2) é baseado no método de segmentação utilizado em \cite{Katsis2006}. De forma similar ao MTD1, também utiliza \emph{threshold} para detecção de picos do sinal e segmentação com janelas de comprimento constante em torno dos picos. Diferentemente do MTD1, MTD2 não é iterativo, utilizando relação entre valor máximo e valor médio do sinal para cálculo do valor de \emph{threshold}.

O terceiro método (MTD3) é baseado no método de segmentação utilizado em \cite{Gut2000}. Uma janela deslizante percorre o sinal, identificando inícios de segmentos quando a variação total no interior da janela excede determinado valor limite. Os finais dos segmentos são identificados quando a variação total do sinal no interior da janela é inferior a um segundo valor de limite.

O quarto método (MTD4) é baseado no método de segmentação utilizado em \cite{Pattichis1995}. Os pontos de início do segmento são tais que, em uma janela à esquerda do ponto, o sinal mantém-se abaixo de determinado \emph{threshold}. Os pontos de final de segmento, de forma similar, são tais que, em uma janela à direita do ponto, o sinal mantém-se abaixo do \emph{threshold}.

Utilizando valores de RMS, variância e frequência mediana dos segmentos obtidos, Redes Neurais Artificiais (RNAs) foram treinadas para classificar entre 17 movimentos de mão e punho. Os objetivos finais deste trabalho são a implementação dos métodos de segmentação propostos e fornecer avaliação comparativa entre métodos quando utilizados para classificação com uso de RNA.

%=========================================================================
% REVISÃO BIBLIOGRÁFICA
	\chapter{Revisão Bibliográfica}
%=========================================================================
		\section{Sinais de Eletromiografia}
%-------------------------------------------------------------------------
Sinais de EMG podem ser adquiridos por eletrodos posicionados na superfície da pele (eletrodo não invasivo) ou por agulhas introduzidas no tecido muscular (eletrodo invasivo). Os sinais são formados por potenciais de ação de fibras musculares organizadas em unidades funcionais chamadas de ``unidades motoras'' (MU - \emph{Motor Unit}) \cite{Luca2006}. Uma MU é composta por um neurônio motor e as fibras musculares que ele inerva, sendo a entidade fundamental que controla a ativação de músculos estriados \cite{Buchthal980}. A soma algébrica dos potenciais de ação de todas as fibras de uma unidade motora é chamada de ``potencial de ação da unidade motora'', ou em inglês, MUAP (\emph{Motor Unit Action Potential}) \cite{Almeida1997}. A Figura \ref{fig_MUAP_comp} apresenta a composição de uma MUAP a partir da soma dos potenciais das fibras de uma unidade motora.

\begin{figure}[htb]
	\caption{\label{fig_MUAP_comp}Soma de potenciais de ação das $n$ fibras de uma unidade motora, formando uma MUAP $h(t)$.}
	\begin{center}
	    \includegraphics[width=0.75\linewidth]{./img/MUAP_oneMU.png}
	\end{center}
	\legend{Fonte: adaptado de \cite{Basmajian1985}.}
\end{figure}

Para os principais métodos utilizados em aquisição do sinal de EMG, é comum a captura da contribuição de mais de uma unidade motora no mesmo canal de aquisição. A influência de uma unidade motora na amplitude do sinal adquirido depende principalmente da distância das fibras musculares ao ponto de aquisição \cite{Gerdle1999}. Sinais de EMG de longa duração são constituídos por sequências temporais de MUAPs, também conhecidas como MUAPTs (\emph{MUAP Trains}). A Figura \ref{fig_MUAP_trains} exemplifica MUAPTs de diferentes MUs que somam-se para formar um sinal de EMG de longa duração.

\begin{figure}[htb]
	\caption{\label{fig_MUAP_trains}MUAPTs de diferentes MUs somam-se para compor o sinal adquirido por um canal de EMG.}
	\begin{center}
	    \includegraphics[width=0.75\linewidth]{./img/MUAP_trains.jpg}
	\end{center}
	\legend{Fonte: adaptado de \cite{Kline2014}}
\end{figure}

Para maiores detalhes sobre sinais de eletromiografia de superfície, conceitos sobre anatomia e fisiologia sugere-se a consulta de referências clássicas na área e adicionalmente as seguintes referências \cite{Favieiro2009}, \cite{Lopes2014} e \cite{Schons2014}.

%-------------------------------------------------------------------------
		\section{Métodos de Segmentação}
%-------------------------------------------------------------------------
\label{sec:MTDs}
Esta seção descreve os métodos de segmentação desenvolvidos, citando os trabalhos da área que foram utilizados como base teórica para os métodos.

Nota-se que nomes utilizados para variáveis e constantes (por exemplo, sinal a ser segmentado `$x$', \emph{threshold} `$T$', etc.) foram determinados pelo autor deste trabalho, não necessariamente sendo os mesmos utilizados nos trabalhos citados.

Para as definições dos Métodos 3 e 4 (MTD3 e MTD4) são utilizados os termos BEP (\emph{Beginning Extraction Point}, ponto inicial de um segmento) e EEP (\emph{Ending Extraction Point}, ponto final de um segmento), também utilizados em \cite{Pattichis1995}.
	
%-------------------------------------------------------------------------
				\subsection{Método 1 - método iterativo utilizando \emph{thresholding} para detecção de centros de segmentos de comprimento constante (MTD1)}
%-------------------------------------------------------------------------
Este método iterativo é adaptado do método de segmentação utilizado em \cite{Chauvet2001}. As definições da Tabela \ref{tab:mtd1params} serão utilizados para descrever este método.

\input{./tables/MTD1_param_descriptions.tex}

Inicialmente, determina-se o valor de \emph{threshold} $T_0$ equivalente ao máximo absoluto do sinal a ser segmentado $x$ (Equação (\ref{eq:mtd1t0})). O valor $T_k$ é atualizado em cada iteração $k$ como sendo uma fração $q$ de $T_{k-1}$ (Equação (\ref{eq:mtd1tk})). No trabalho de \cite{Chauvet2001}, este valor $q$ foi empiricamente determinado em 90\%.

\begin{equation}
\label{eq:mtd1t0}
  T_0 = max(x)
\end{equation}

\begin{equation}
\label{eq:mtd1tk}
  T_k = q \times T_{k-1}
\end{equation}

Pontos do sinal acima do valor de $T_k$ são possíveis candidatos para centros de segmentos. Caso exista mais de um possível candidato em uma vizinhança bilateral de $l$ amostras do sinal, apenas o ponto de maior amplitude nesta vizinhança é considerado. Para determinar o processo de finalização do método, avalia-se a razão $r_k$ entre a quantidade identificada de candidatos $N_{k}$ e o comprimento total do sinal $L$ (Equação (\ref{eq:mtd1rk})). Caso $r_k$ seja menor que um valor predeterminado $r_{target}$, calcula-se $T_{k+1}$ para realização da próxima iteração (Equação (\ref{eq:mtd1tk})). Caso $r_k$ seja maior ou igual ao valor predeterminado $r_{target}$, encerra-se o método e os segmentos são tomados como janelas de sinal de comprimento $l$, centradas nos candidatos identificados na última iteração.

\begin{equation}
\label{eq:mtd1rk}
  r_k = \frac{N_{k}}{L} 
\end{equation}

Adicionalmente, o estabelecimento de um valor limite mínimo para \emph{threshold} $T_{lim}$ garante que o método não entre em laço infinito e evita detecção de segmentos em trechos de baixa atividade muscular. Caso o valor de \emph{threshold} $T_k$ para a iteração atual seja inferior a $T_{lim}$, encerra-se o processo iterativo. O método de segmentação MTD1 é representado pelo fluxograma da Figura \ref{fig_mtd1flux}.

\input{./flowcharts/MTD1.tex}

%-------------------------------------------------------------------------
			\subsection{Método 2 - método não iterativo utilizando \emph{thresholding} para detecção de centros de segmentos de comprimento constante (MTD2)}
%-------------------------------------------------------------------------
Este é o método de segmentação utilizado por \cite{Katsis2006}, que será descrito pelas definições da Tabela \ref{tab:mtd2params}. Primeiramente, seleciona-se entre dois métodos de cálculo de \emph{threshold} $T$: ou utiliza-se $T$ como múltiplo da média aritmética do sinal $x$; ou $T$ é uma fração do valor máximo do sinal $x$. \cite{Katsis2006} utilizaram a relação do fluxograma da Figura \ref{fig_mtd2flux} para o cálculo de \emph{threshold} $T$.

\input{./tables/MTD2_param_descriptions.tex}

\input{./flowcharts/MTD2.tex}

De forma similar ao MTD1, os pontos do sinal que tiverem valor acima de $T$ são considerados possíveis candidatos para centros de segmentos. Para os possíveis candidatos que estiverem afastados de uma distância inferior a $l$, apenas o candidato de maior amplitude é considerado. Em \cite{Katsis2006} foram utilizados coeficientes $A$, $B$ e $C$ respectivamente de 30, 5 e 5, com comprimento $l$ de 121 amostras.

%-------------------------------------------------------------------------
			\subsection{Método 3 - método com janela deslizante para detecção de BEP e EEP de segmentos utilizando variação total (MTD3)}
%-------------------------------------------------------------------------
Este é o método de segmentação utilizado em \cite{Gut2000}. As definições da Tabela \ref{tab:mtd3params} serão utilizados para descrever este método. Uma janela deslizante de comprimento $W$ percorre o sinal da esquerda para a direita. A cada incremento de $step$ amostras, caso a variação total $V$ (Equação (\ref{eq:varTotal})) do trecho de sinal contido pela janela exceda um limite $B$ (sendo $B > 0$), o ponto mais à esquerda da janela $w_0$ determina a BEP de um segmento. O EEP do correspondente segmento é então obtido como o ponto mais à direita ($w_0 + W$) da próxima janela na qual a variação total for menor que um limite $C$ (sendo $C < 0$). O MTD3 pode ser representado pelo fluxograma da Figura \ref{fig_mtd3flux}.

\input{./tables/MTD3_param_descriptions.tex}

\begin{equation}
\label{eq:varTotal}
	V = \sum\limits_{i=w_0+1}^{w_0+W} (x_i - x_{i-1})
\end{equation}

\input{./flowcharts/MTD3.tex}

No método original de \cite{Gut2000}, BEPs foram detectadas pelo cálculo da declividade média $\beta$ no interior da janela (Equação (\ref{eq:decMedia})) nos pontos que excediam um limite $B$ (sendo $B > 0$), e EEPs pelo cálculo do módulo da variação total (Equação (\ref{eq:absVarTotal})) quando esta era menor que um limite $C$ (sendo $C > 0$).

\begin{equation}
\label{eq:decMedia}
	\beta = \frac{1}{W}\sum\limits_{i=w_0+1}^{w_0+W} (x_i - x_{i-1})
\end{equation}

\begin{equation}
\label{eq:absVarTotal}
	\gamma = \left|\sum\limits_{i=w_0+1}^{w_0+W} (x_i - x_{i-1})\right|
\end{equation}

Nota-se que $\gamma = |W\beta| = |V|$. O MTD3 proposto, ao utilizar apenas a Equação (\ref{eq:varTotal}) para detecção de BEPs e EEPs, explora tal relação para simplificar o método original, com a vantagem adicional de que os limites $B$ e $C$ passam a ser da mesma ordem de grandeza (com o método de \cite{Gut2000}, $B$ seria aproximadamente $W$ vezes menor que $C$).

O incremento de $step$ amostras (ao invés do avanço de $w_0$ de uma em uma amostra) serve para reduzir o número de vezes em que é necessário cálculo de variação total $V$, simplificando o processamento. Os limites de $l_{mín}$ e $l_{máx}$ são necessários para evitar identificação incorreta da EEP relacionada a uma BEP (i.e. $l_{máx}$ evita que o segmento BEP-EEP contenha sinal respectivo a mais de um movimento e $l_{mín}$ que o sinal seja segmentado em meio a um movimento).

%-------------------------------------------------------------------------
			\subsection{Método 4 - método com janela deslizante para detecção de BEP e EEP de segmentos utilizando \emph{thresholding} (MTD4)}
%-------------------------------------------------------------------------
Este método de segmentação é adaptado de \cite{Pattichis1995}. As definições da Tabela \ref{tab:mtd4params} serão utilizados para descrever este método.

\input{./tables/MTD4_param_descriptions.tex}

Uma janela deslizante de comprimento $W$, com início em $w_0$, percorre o sinal da esquerda para a direita. As BEPs de segmentos são os primeiros pontos $w_0$ em que o máximo valor de sinal $x$ contido na janela supera o valor de \emph{threshold} $T$. As EEPs associadas às BEPs são as posições $w_0 + W$ em que tal valor máximo volta a ser inferior a $T$. Assim como no MTD3, restrições para comprimento mínimo e máximo ($l_{mín}$ e $l_{máx}$) de segmentos são utilazadas. O fluxograma da Figura \ref{fig_mtd4flux} representa o MTD4.

\input{./flowcharts/MTD4_new.tex}

%-------------------------------------------------------------------------
		\section{Princípios Básicos sobre Redes Neurais Artificiais}
%-------------------------------------------------------------------------
Rede Neural Artificial (RNA) trata-se de um método computacional que, inspirado nos modelos de redes neurais biológicas, ``aprende'' a resolver determinados problemas \cite{YEGNANARAYANA2009}, apresentando aplicações em diversos tipos de sinais (e.g. sinais de áudio, imagem e, como é o caso deste trabalho, eletromiografia).

Propostas de utilização de RNA com sinais de EMG para classificação de movimentos datam antes de 1990, a exemplo do trabalho de \cite{Hiraiwa1989}, que menciona a vantagem de RNA sobre outros mecanismos de aprendizado computacional na classificação de padrões que não apresentam separabilidade linear. Desde então, múltiplos trabalhos na área já utilizaram RNA para classificação de movimentos utilizando EMG (e.g. \cite{Hudgins1993}, \cite{Subasi2006}, \cite{Bu2003}), apresentando resultados satisfatórios para taxa de acerto de classificação.

Uma RNA é modelada pelas comunicações de um conjunto de ``neurônios'' artificiais. Cada neurônio artificial, como mostrado na Figura \ref{fig:neuron}, trata-se de uma função matemática que soma de forma ponderada $n$ entradas com pesos $w_n$ e um valor de \emph{bias} $B$ e utiliza o resultado desta soma em uma função dita ``função de ativação'' \cite{Tanikic2012}.

\input{./flowcharts/neuronio.tex}

As RNAs utilizadas neste trabalho apresentam arquitetura chamada \emph{feedforward}, onde neurônios são estruturados em camadas consecutivas, de forma que neurônios de uma mesma camada recebem as saídas de neurônios da camada anterior. A Figura \ref{fig:feedforward} exemplifica a estrutura de uma rede neural \emph{feedforward} que utiliza $m$ entradas para produzir $n$ saídas, utilizando duas camadas de neurônios chamadas de ``camadas ocultas'' (i.e. a saída da camada é utilizada como entrada da próxima camada) e uma camada de saída.

\input{./flowcharts/feedforward.tex}

\cite{Hornik1991} mostra que ao utilizar neurônios com função de ativação contínua, limitada e não constante, a taxa de acerto de classificação para uma RNA de arquitetura \emph{feedforward} depende somente do número de neurônios artificiais utilizados nas camadas ocultas. Em aplicações de reconhecimento de padrões, normalmente utiliza-se uma função de ativação do tipo sigmoide (i.e. função cuja curva lembra a forma de um ``S'').  A função de ativação utilizada para RNAs, neste trabalho, é a função sigmoide logística $logsig()$, dada pela Equação (\ref{eq:logsig}).

\begin{equation}
\label{eq:logsig}
	logsig(x) = \frac{1}{1+e^{-x}}
\end{equation}

Uma RNA pode ser utilizada para resolver determinado problema após um processo de treinamento supervisionado. Conjuntos de dados de treinamento (entradas e respostas esperadas) são apresentados à RNA. Um algoritmo iterativo modifica os pesos e \emph{bias} dos neurônios buscando combinação que otimize o desempenho da RNA para os dados de treinamento. Às iterações do algoritmo de treinamento, em que os dados de treinamento são reapresentados à RNA, dá-se o nome de \emph{epoch}. O algoritmo utilizado para treinamento de RNAs, neste trabalho, chama-se \emph{scaled conjugate gradient backpropagation} \cite{Moller1993} (identificado em MATLAB como \emph{trainscg}), que apresenta boa performance em problemas de reconhecimento de padrões.

Quando uma RNA é aplicada para classificação de séries temporais de sinais, as entradas (chamadas ``preditores'') utilizadas pela RNA são características extraídas de um trecho do sinal (e.g. número de cruzamentos por zero, valor médio, valor RMS). A extração de características tem o objetivo de reduzir a dimensionalidade do vetor de entradas da RNA (i.e. ao invés de um trecho de sinal com grande número de amostras, a entrada da RNA trata-se de um número arbitrariamente pequeno de preditores), o que apresenta vantagens em desempenho computacional e contorna problemas que surgem da classificação de sinais ruidosos \cite{Kim2000}.

Para maiores detalhes sobre RNAs e outros métodos de aprendizado computacional, sugere-se consulta das seguintes referências. \cite{YEGNANARAYANA2009}, \cite{Abraham2005} e \cite{Drew20003}.

%=========================================================================
% METODOLOGIA EXPERIMENTAL
	\chapter{Metodologia Experimental}
%=========================================================================

%-------------------------------------------------------------------------
		\section{Bases de Dados Utilizadas}
%-------------------------------------------------------------------------
Este trabalho faz uso de aquisições para o exercício 1 da base de dados número 2 do projeto NinaPro \cite{Gijsberts2014} e a base de dados em construção realizada pelo Laboratório de Instrumentação Eletro-Eletrônica (IEE). A base de dados do IEE busca replicar os métodos de aquisição utilizados pelo projeto NinaPro, contando com os mesmos movimentos realizados, mesmo posicionamento de eletrodos e mesmo período de amostragem (500 $\mu s$).

%-------------------------------------------------------------------------
			\subsection{Posicionamento de Eletrodos}
%-------------------------------------------------------------------------
Os sinais de EMG de superfície para ambas as bases utilizadas neste trabalho são compostos por canais de aquisição de 12 eletrodos posicionados no braço direito de voluntários saudáveis (i.e. não amputados e sem desordens neuromusculares). Os primeiros 8 canais correspondem a eletrodos posicionados de forma a circundar o antebraço e a junção úmero-radial. O eletrodo do canal número 9 é posicionado sobre o músculo flexor superfícial dos dedos e o eletrodo do canal 10, em oposição, é posicionado sobre o músculo extensor dos dedos. Os últimos dois eletrodos, 11 e 12, são posicionados sobre o bíceps e o tríceps, respectivamente. A Figura \ref{fig:eletrodos} apresenta o posionamento para os doze eletrodos de superfície e a numeração de seus respectivos canais que compõem os sinais para ambas as bases de dados.

\begin{figure}[htb]
	\caption{\label{fig:eletrodos}Posicionamento de eletrodos de superfície no braço de um voluntário.}
	\begin{center}
	    \includegraphics[width=0.75\linewidth]{./img/eletrodos.png}
	\end{center}
	\legend{Fonte: adaptado de \cite{Gijsberts2014}}
\end{figure}

%-------------------------------------------------------------------------
			\subsection{Sistema para Aquisição de EMGs no IEE}
%-------------------------------------------------------------------------
Para aquisições realizadas no IEE, os eletrodos são conectados a dois sistemas de aquisição EMG 830C, produzidos pela empresa ``EMG \emph{System} do Brasil'', de oito canais cada (os canais de número 1 a 8, que circundam a junção úmero-radial, são conectados ao primeiro sistema e os canais 9 a 12 ao segundo sistema). Os sinais de referência para os canais são tomados de eletrodos posicionados na testa do volutário.

Os sistemas EMG 830C são conectados a um computador pelo conjunto de \emph{Data Acquisition} (DAQ) NI SCB-68A e NI USB-6289. O computador executa uma rotina de aquisição de sinais implementada em NI LabView que é também responsável por exibir um vídeo com movimentos a serem replicados pelo voluntário. O diagrama da Figura \ref{fig:daq} resume o sistema de aquisição para a base de dados do IEE.

\input{./flowcharts/daq.tex}

%-------------------------------------------------------------------------
			\subsection{Movimentos de Interesse}
%-------------------------------------------------------------------------
Após o posicionamento de eletrodos, os voluntários sentam-se em frente a um monitor e apoiam o braço direito de forma relaxada sobre uma superfície horizontal próxima à altura do cotovelo. O monitor exibe um vídeo com uma mão direita, digitalmente animada, realizando movimentos de interesse que devem ser replicados pelos voluntários. A Figura \ref{fig:video} apresenta a mão digitalmente animada realizando alguns dos movimentos de interesse deste trabalho.

\begin{figure}[htb]
	\caption{\label{fig:video}Cenas do vídeo apresentado aos voluntários na aquisição do Laboratório IEE.}
	\begin{center}
	    \includegraphics[width=0.75\linewidth]{./img/scenes.png}
	\end{center}
	\legend{Fonte: Laboratório de Intrumentação Eletro-Eletrônica, UFRGS}
\end{figure}

Primeiramente, realiza-se um ``treinamento'' com o voluntário, exibindo o vídeo e apresentando os movimentos que devem ser realizados (sem aquisição de sinal), de modo a reduzir possíveis erros na realização de movimentos para uma segunda exibição, quando os sinais de EMG serão devidamente adquiridos. Cada movimento apresentado em vídeo tem duração de 5 segundos, com um intervalo de 3 segundos de repouso entre movimentos. O voluntário realiza 6 repetições consecutivas para os 17 movimentos descritos na Tabela \ref{tab:movimentos}.

\input{./tables/movimentos.tex}

%-------------------------------------------------------------------------
		\section{Métodos de Segmentação}
%-------------------------------------------------------------------------
Esta seção descreve a implementação dos métodos de segmentação propostos. O diagrama de blocos da Figura \ref{flow:MTDs} apresenta de forma resumida os passos comuns aos quatro métodos, que serão explanados nas subseções seguintes. Os códigos criados para os quatro métodos, escritos para MATLAB R2015a, encontram-se nos Apêndices \ref{ap:seg_mtd1} a \ref{ap:seg_mtd4}.

\input{./flowcharts/MTDsResumo.tex}

%-------------------------------------------------------------------------
			\subsection {Preprocessamento}
%-------------------------------------------------------------------------

Os sinais de eletromiografia para ambas as bases de dados (NinaPro e IEE) são armazenados mantendo sua polaridade original (i.e. amostras do sinal podem assumir valores positivos e negativos). Primeiramente, realiza-se a retificação completa dos sinais tomando o módulo dos valores amostrados (em MATLAB, função \emph{abs()}). A retificação completa do sinal mantém sua energia e é fundamental para a implementação dos métodos de segmentação aqui desenvolvidos.

Após a etapa de retificação, os sinais para cada canal de aquisição são normalizados de acordo com seu valor máximo, de modo que seu novo valor máximo seja unitário, a partir da Equação (\ref{eq:x_normalization}), onde $x$ é o sinal original para um canal e $x_{norm}$ é sua versão normalizada. A normalização de canais faz com que os parâmetros utilizados pelos métodos de segmentação sejam relativos ao valor máximo do sinal, possibilitando a implementação para diferentes voluntários. A Figura \ref{fig:normalization} exemplifica retificação e normalização para trecho de sinal de um canal de EMG.

\begin{equation}
	\label{eq:x_normalization}
	x_{norm} = \frac{x}{max(x)}
\end{equation}

\begin{figure}[htb]
	\caption{\label{fig:normalization}Exemplo para retificação e normalização de trecho de sinal de EMG.}
	\begin{center}
	    \includegraphics[width=0.75\linewidth]{./img/matlab/prettyRaw.eps}
	\end{center}
	%\legend{Fonte: adaptado de BASMAJIAN \& DE LUCA, 1985}
\end{figure}

%-------------------------------------------------------------------------
				\subsection{Parâmetros Ajustáveis}
%-------------------------------------------------------------------------
Cada método de segmentação MTD1 - MTD4 apresenta um conjunto de parâmetros ajustáveis. Tais parâmetros foram descritos anteriormentes na Seção \ref{sec:MTDs} (Tabelas \ref{tab:mtd1params} a \ref{tab:mtd4params}). Após investigações iniciais de segmentações obtidas com diferentes valores de parâmetros, listou-se valores a serem explorados na aplicação de cada método. A Tabela \ref{tab:combinacoes} apresenta os parâmetros ajustáveis de cada método e sua respectiva lista de valores explorados.

\input{./tables/combinacoes}

Para os métodos que necessitam parâmetro de comprimento de segmento $l$ (i.e. os métodos que produzem segmentos de comprimento de janela constante, MTD1 e MTD2) utilizou-se valor de $l$ como $10 \times 10^3$, que corresponde a 5 cinco segundos de aquisição para ambas as bases de dados (período de amostragem para ambas é de 500 $\mu s$), sendo a mesma duração dos segmentos de vídeo replicados pelos voluntários.

Para os métodos que utilizam janela deslizante (MTD3 e MTD4), utilizou-se comprimento de janela $W$ de 5000 amostras, de modo que o comprimento temporal da janela (2,5 segundos) equivale à metade da duração do segmento de vídeo, com incrementos $step$ de 100 amostras. Os parâmetros de $l_{mín}$ e $l_{máx}$ utilizados foram de 7500 e 12500 amostras, respectivamente.

O valor de $r_{target}$  para o MTD1 foi obtido utilizando o código do Apêndice \ref{ap:r_target} como sendo valor mínimo da razão entre número de segmentos e comprimento de sinal para os voluntários de cada base de dados da NinaPro e IEE.

%-------------------------------------------------------------------------
			\subsection{Agrupamento das Posições de Segmentos de Diferentes Canais Utilizando DBSCAN}
%-------------------------------------------------------------------------
Como já mencionado, os sinais para ambas as bases de dados são compostos por doze canais de aquisição. Os métodos de segmentação são implementados individualmente para os doze canais. Para os métodos MTD1 e MTD2, posições centrais dos segmentos obtidas em cada canal são armazenadas, enquanto que para os métodos MTD3 e MT4 armazena-se as posições de BEPs e EEPs. Tais posições de diferentes canais são identificadas como pertencendo a um mesmo segmento através do algoritmo de grupamento DBSCAN (\emph{Density-Based Spatial Clustering of Applications with Noise}).

DBSCAN foi inicialmente proposto em \cite{Ester1996} para grupamento de pontos utilizando dois parâmetros: $\epsilon$, que define uma vizinhança em torno do valor de cada ponto, e $minPts$, que determina o número mínimo de pontos pertencentes à mesma vizinhança para formação do ``núcleo'' de um grupo. Para mais detalhes sobre DBSCAN, sugere-se o artigo original \cite{Ester1996} e a revisão do método \cite{Thanh2013}, cujo código em MATLAB foi utilizado (Apêndice \ref{ap:dbscan}). 

Na implementação dos quatro métodos, utilizou-se $\epsilon = 2000$ amostras e $minPts = 3$ canais. Em outras palavras, isto significa que para a identificação de um centro de segmento (métodos MTD1 e MTD2) ou de BEPs e EEPs (métodos MTD3 e MTD4) é necessário que as posições identificadas, em pelo menos 3 diferentes canais, pertençam a uma vizinhança bilateral de 4000 amostras (2 segundos de aquisição).

O algoritmo DBSCAN foi escolhido para esta aplicação por dois motivos principais. Primeiramente, ao contrário de métodos de grupamento como \emph{k-means}, DBSCAN não necessita parâmetro que especifique número de grupos, no caso, número de segmentos a serem obtidos, o que mantém o caráter ``automático'' dos métodos de segmentação. Além disto, o parâmetro $minPts$ faz com que este método seja capaz de descartar posições \emph{outliers} que venham a ser identificadas por canal. Sendo assim, o algoritmo DBSCAN é capaz de tornar mais robusto os métodos de segmentação e implementáveis a sinais de múltiplos canais.

Após o agrupamento de posições de segmentos obtidos nos diferentes canais, tomam-se as médias de cada grupo como as posições nas quais o sinal deve ser segmentado (para os métodos MTD1 e MTD2, as médias dos grupos indicam posições centrais de segmentos e para métodos MTD3 e MTD4 indicam posições de BEPs e EEPs). O sinal é segmentado nestas posições para os doze canais, mantendo a coerência temporal entre canais.

%-------------------------------------------------------------------------
		\section{Classificação de Segmentos com Redes Neurais Artificiais}
%-------------------------------------------------------------------------
Esta seção descreve o uso de RNAs para classificação dos segmentos obtidos de acordo com movimentos de interesse. O processo de classificação é representado pelo diagrama de blocos da Figura \ref{flow:RNAs}, que será explanado nas subseções seguintes.

\input{./flowcharts/RNAresumo.tex}

%-------------------------------------------------------------------------
			\subsection{Características Utilizadas como Preditores}
%-------------------------------------------------------------------------
Os preditores (``entradas'') das RNAs são o valor RMS, a variância e a frequência mediana do espectro de potência dos segmentos de sinal obtidos pelos métodos MTD1 - MTD4. Tais características foram selecionados de acordo com outros trabalhos já realizados no Laboratório de Instrumentação Eletro-Eletrônica que obtiveram bons resultados em métodos de iteligência computacional, como \cite{Favieiro2009}, \cite{Schons2014} e \cite{Cene2015}.

O valor RMS ou \emph{Root Mean Square} de um sinal discreto \emph{x} de comprimento $L$ (em MATLAB, função \emph{rms()}) é dada pela Equação (\ref{eq:rms}) e a variância deste sinal (em MATLAB, função \emph{var()}) é dada pela Equação (\ref{eq:var}), onde $\bar{x}$ é o valor médio do sinal. A frequência mediana é tal que a soma total da densidade de potência para frequências abaixo da frequência mediana é igual à soma total da densidade de potência para frequências acima da frequência mediana, sendo estimada pela função \emph{medfreq()} em MATLAB.

\begin{equation}
	\label{eq:rms}
	rms(x) = \sqrt{\frac{1}{L}\sum\limits_{i=1}^{L}x_i^2} 
\end{equation}

\begin{equation}
	\label{eq:var}
	var(x) = \frac{1}{L-1}\sum\limits_{i=1}^{L}(x_i - \bar{x})^2
\end{equation}

%-------------------------------------------------------------------------
			\subsection{Classes de Movimentos Utilizadas como Resposta}
%-------------------------------------------------------------------------
Realiza-se a identificação de movimentos associados a cada segmento obtido a partir de sua posição temporal no sinal original, já que durante a aquisição de dados os movimentos são realizados na mesma sequência para todos os voluntários. A base de dados NinaPro apresenta um vetor \emph{stimulus} que indica os instantes em que foram apresentados cada movimento a ser replicado pelo volunário. A partir deste vetor e das posições dos segmentos dentro do sinal original, utiliza-se o código apresentado no Apêndice \ref{ap:idMoves} para criar o vetor de respostas esperadas no treinamento da RNA.

\textcolor{red}{TODO: explicar o equivalente realizado para a base de dados IEE}

%-------------------------------------------------------------------------
			\subsection{Separação de Grupos de Treino, Validação e Teste para Treinamento}
%-------------------------------------------------------------------------
Os grupos de segmentos utilizadas no treinamento da rede neural são tais que:

\begin{itemize}
\item grupo de treino: primeiros quatro segmentos obtidos para uma mesma classe de movimento
\item grupo de validação: quinto segmento obtido para cada classe de movimento
\item grupo de teste: demais segmentos
\end{itemize}

Optou-se por este controle da divisão por indexação (método de divisão chamado em MATLAB de $divideind$) ao invés de métodos de divisão aleatória de grupos ($dividerand$) para evitar possíveis situações particulares nas quais todos (ou, na situação oposta e igualmente incômoda, nenhum) segmentos para determinada classe de movimento seria incluso no grupo ``treino'', as quais viciariam resultados de classificação.

%-------------------------------------------------------------------------
			\subsection{Estrutura de RNAs utilizada}
%-------------------------------------------------------------------------
As RNAs utilizadas para todos os métodos são do tipo \emph{feedforward}, compostas por uma camada oculta e uma camada de saída, sendo a camada oculta formada por 40 neurônios com função de ativação $logsig()$ (Equação (\ref{eq:logsig})) e camada de saída por 17 neurônios, um para cada classe de movimento, de forma que o neurônio com saída de maior valor indica qual a classe de movimento em que foi classificado o segmento. 

\textcolor{red}{TODO: finalizar esta subseção; adicionar imagem do matlab mostran a arquitetura da RNA}

%-------------------------------------------------------------------------
			\subsection{Valor F de RNAs}
%-------------------------------------------------------------------------
Para avaliação de taxas de acerto de um sistema classificador, costumeiramente utiliza-se uma tabela conhecida como ``matriz de confusão''. A Tabela \ref{tab:conf_example} exemplifica uma matriz de confusão genérica.

\begin{table}[htb]
\IBGEtab{%
	\caption{Exemplo de matriz de confusão.}%
	\label{tab:conf_example}
}{%
	\begin{tabular}{cc|c|c}
	\toprule
	&&\multicolumn{2}{c}{Classificação obtida}\\
	\midrule
	&& Negativa & Positiva\\
	\midrule \midrule
	Classificação&Negativa&$a$&$b$\\
	\cline{2-4}
	esperada&Positiva&$c$&$d$\\
	\bottomrule
\end{tabular}%
}{%
	$a$: verdadeiros negativos\\
	$b$: falsos positivos     \\
	$c$: falsos negativos     \\
	$d$: verdadeiros positivos\\
	Fonte: adaptado de \cite{Kubat1998}.
}
\end{table}

No caso das RNAs deste trabalho, que realizam classificação entre 17 classes de movimentos, a Tabela \ref{tab:conf_example} pode ser obtida para cada uma das classes, onde ``Positivo'' indica a ocorrência da classe de movimento e ``Negativo'' a não-ocorrência da mesma. O valor $F$ da RNA para uma determinada classes de movimento é definida como a média harmônica entre precisão $p$ (Equação(\ref{eq:precisao})) e a sensitividade $r$ (Equação(\ref{eq:sensitividade})), conforme a Equação (\ref{eq:fscore}).

\begin{equation}
\label{eq:precisao}
	p = \frac{d}{b+d}
\end{equation}

\begin{equation}
\label{eq:sensitividade}
	r = \frac{d}{c+d}
\end{equation}

\begin{equation}
\label{eq:fscore}
	F = 2 \times \frac{p \times r}{p+r}
\end{equation}

Como cada série de dados avaliada pelas RNAs refere-se à realização de 17 classes movimentos distintos em 6 repetições, o número de casos esperados negativos é, para cada classe, 16 vezes maior que o número de casos esperados positivos. O valor $F$, ao não utilizar número de classificações verdadeiramente negativas $a$, não é diretamente viciado por esta disparidade no número de casos positivos e negativos.

%=========================================================================
% RESULTADOS E DISCUSSÕES
	\chapter{Resultados e Discussões}
%=========================================================================
		\section{Número de Segmentos Obtidos por Movimento e Sensitividade}
%-------------------------------------------------------------------------
As diferentes combinações de parâmetros testadas foram indexadas por método de segmentação de acordo com a Tabela \ref{tab:combinacoes_expanded}. As Figuras \ref{fig:mtd1-nina} a \ref{fig:mtd4-iee} apresentam resultados para média e moda do número de segmentos obtidos por classe de movimento com a implementação de cada combinação de parâmetros dos métodos a todos os voluntários de cada base de dados. Também apresenta-se resultados para sensitividade média para classificação por RNAs. 

\input{./tables/combinacoes_expanded.tex}

\begin{figure}[htb]
	\caption{\label{fig:normalization}Média e moda do número de segmentos obtidos por classe de movimento e sensitividade média de RNAs. Método de segmentação: MTD1. Base de dados: NinaPro}.
	\begin{center}
	    \includegraphics[width=0.75\linewidth]{./img/matlab/results/mtd1_nina.eps}
	\end{center}
	%\legend{Fonte: adaptado de BASMAJIAN \& DE LUCA, 1985}
\end{figure}

\begin{figure}[htb]
	\caption{\label{fig:normalization}Média e moda do número de segmentos obtidos por classe de movimento e sensitividade média de RNAs. Método de segmentação: MTD2. Base de dados: NinaPro}.
	\begin{center}
	    \includegraphics[width=0.75\linewidth]{./img/matlab/results/mtd2_nina.eps}
	\end{center}
	%\legend{Fonte: adaptado de BASMAJIAN \& DE LUCA, 1985}
\end{figure}

\textcolor{red}{TODO: finalizar análise após obtenção de mais resultados}

%-------------------------------------------------------------------------
		\section{Classificação de Movimentos Utilizando RNAs}
%-------------------------------------------------------------------------
Para os resultados de segmentação obtidos com diferentes parâmetros testados apresentados nas Tabelas \ref{tab:num_mtd1_ninapro} a \ref{tab:number_mtd4_iee}, identificou-se as combinações de parâmetros que apresentaram os resultados de segmentação mais satisfatórios (i.e. parâmetros que segmentaram em seis partes cada movimento para o maior número possível de voluntários da base) para serem usados nos nos códigos dos apêndices \ref{ap:rna_mtd1} a \ref{ap:rna_mtd4}, que realizam segmentação e classificação de movimentos utilizando RNA. As combinações de parâmetros selecionadas são apresentadas na Tabela \ref{tab:chosen_params}.

\input{./tables/chosen_params.tex}

%=========================================================================
% CONCLUSÃO
	\chapter{Conclusões}
%=========================================================================

%=========================================================================
% PROPOSTA DE TRABALHOS FUTUROS
	\chapter{Propostas de Trabalhos Futuros}
%=========================================================================

\textcolor{red}{PROPOSTAS: tradução dos códigos para outras linguagens (e.g. C++, Python); adaptação dos métodos para versões causais; aplicação no controle de prótese}

%=========================================================================
% REFERÊNCIAS BIBLIOGRÁFICAS
	\postextual
	\bibliography{referencias.bib}
%=========================================================================

%=========================================================================
% APÊNDICES
	\begin{apendicesenv}
	\partapendices
%=========================================================================
\chapter{Função em MATLAB para MTD1}
\lstinputlisting{../../MATLAB/seg_mtd1.m}
\label{ap:seg_mtd1}
%-------------------------------------------------------------------------
\chapter{Função em MATLAB para MTD2}
\lstinputlisting{../../MATLAB/seg_mtd2.m}
\label{ap:seg_mtd2}
%-------------------------------------------------------------------------
\chapter{Função em MATLAB para MTD3}
\lstinputlisting{../../MATLAB/seg_mtd3.m}
\label{ap:seg_mtd3}
%%-------------------------------------------------------------------------
\chapter{Função em MATLAB para MTD4}
\lstinputlisting{../../MATLAB/seg_mtd4.m}
\label{ap:seg_mtd4}
%-------------------------------------------------------------------------
\chapter{Código utilizado para determinação de $r_{target}$ do MTD1}
\label{ap:r_target}
\lstinputlisting{../../MATLAB/rtarget_mtd1.m}
%-------------------------------------------------------------------------
\chapter{Função em MATLAB para obtenção dos movimentos relacionados aos segmentos}
\label{ap:idMoves}
\lstinputlisting{../../MATLAB/identifyClasses.m}
%-------------------------------------------------------------------------
\end{apendicesenv}

%=========================================================================
% ANEXOS
	\begin{anexosenv}
	\partanexos
%=========================================================================
\chapter{Função em MATLAB para agrupamento com DBSCAN \cite{Thanh2013}}
\label{ap:dbscan}
\lstinputlisting{../../MATLAB/dbscan.m}
%-------------------------------------------------------------------------
\end{anexosenv}

\end{document}
